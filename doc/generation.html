<!DOCTYPE html><html lang="en"><head><title>generation</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="generation"><meta name="groc-project-path" content="samples/generation.rb"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path">samples/generation.rb</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><p>Some generation related <a href="configuration.rb">configuration</a>.</p></div></div><div class="code"><div class="wrapper"><span class="nb">require</span> <span class="s1">&#39;pacto&#39;</span>
<span class="no">WebMock</span><span class="o">.</span><span class="n">allow_net_connect!</span>
<span class="no">Pacto</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
  <span class="n">c</span><span class="o">.</span><span class="n">contracts_path</span> <span class="o">=</span> <span class="s1">&#39;contracts&#39;</span>
<span class="k">end</span>
<span class="no">WebMock</span><span class="o">.</span><span class="n">allow_net_connect!</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Once we call <code>Pacto.generate!</code>, Pacto will record contracts for all requests it detects.</p></div></div><div class="code"><div class="wrapper"><span class="no">Pacto</span><span class="o">.</span><span class="n">generate!</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Now, if we run any code that makes an HTTP call (using an
<a href="https://github.com/bblimke/webmock#supported-http-libraries">HTTP library supported by WebMock</a>)
then Pacto will generate a Contract based on the HTTP request/response.
This code snippet will generate a Contract and save it two <code>contracts/api.github.com/repos/thoughtworks/pacto/readme.json</code>.</p></div></div><div class="code"><div class="wrapper"><span class="nb">require</span> <span class="s1">&#39;octokit&#39;</span>
<span class="n">readme</span> <span class="o">=</span> <span class="no">Octokit</span><span class="o">.</span><span class="n">readme</span> <span class="s1">&#39;thoughtworks/pacto&#39;</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>We're getting back real data from GitHub, so this should be the actual file encoding.</p></div></div><div class="code"><div class="wrapper"><span class="nb">puts</span> <span class="n">readme</span><span class="o">.</span><span class="n">encoding</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The generated contract will contain expectations based on the request/response we observed,
including a best-guess at an appropriate json-schema.  Our heuristics certainly aren't foolproof,
so you might want to customize schema!</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Here's another sample that sends a post request.</p></div></div><div class="code"><div class="wrapper"><span class="n">client</span> <span class="o">=</span> <span class="ss">Octokit</span><span class="p">:</span><span class="ss">:Client</span><span class="o">.</span><span class="n">new</span> <span class="ss">:access_token</span> <span class="o">=&gt;</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;GITHUB_TOKEN&#39;</span><span class="o">]</span>
<span class="n">client</span><span class="o">.</span><span class="n">mark_notifications_as_read</span><span class="p">({</span> <span class="ss">:last_read_at</span> <span class="o">=&gt;</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="mi">9999999</span> <span class="p">})</span></div></div></div></div></body></html>